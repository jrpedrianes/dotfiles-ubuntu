#!/usr/bin/env bash

# {{ template "scripts-library" }}

# The following line is for ShellCheck to correctly identify the above included library
true || source ../.chezmoitemplates/scripts-library

function gsettings_ensure() {
  local schema="$1"
  local key="$2"
  local value="$3"
  local extension="${4:-}"

  local first_args=()
  if [[ -n "${extension}" ]]; then
    first_args+=(--schemadir "${HOME}/.local/share/gnome-shell/extensions/${extension}/schemas")
  fi

  local current_value
  current_value="$(gsettings "${first_args[@]}" get "${schema}" "${key}")"

  if [[ "${current_value}" != "${value}" && "${current_value}" != "'${value}'" ]]; then
    log_task "Setting ${schema}.${key} to ${value}"
    gsettings "${first_args[@]}" set "${schema}" "${key}" "${value}"
  fi
}

profile_id=$(gsettings get org.gnome.Terminal.ProfilesList list | sed "s/\['//" | sed "s/'\]//")

gsettings_ensure org.gnome.desktop.interface monospace-font-name 'FiraCode Nerd Font Mono 13'
gsettings_ensure org.gnome.desktop.interface gtk-theme 'Yaru-blue-dark'
gsettings_ensure org.gnome.desktop.interface icon-theme 'Yaru-blue'

gsettings_ensure org.gnome.shell.extensions.dash-to-dock dash-max-icon-size 32
gsettings_ensure org.gnome.shell.extensions.dash-to-dock dock-fixed false
gsettings_ensure org.gnome.shell.extensions.dash-to-dock dock-position 'BOTTOM'
gsettings_ensure org.gnome.shell.extensions.dash-to-dock extend-height false
gsettings_ensure org.gnome.shell.extensions.dash-to-dock multi-monitor true
gsettings_ensure org.gnome.shell.extensions.dash-to-dock show-mounts-only-mounted true

gsettings_ensure org.gnome.desktop.notifications show-in-lock-screen false
gsettings_ensure org.gnome.desktop.session idle-delay 'uint32 300'

# Configuring terminal font
gsettings_ensure "org.gnome.Terminal.Legacy.Profile:/org/gnome/terminal/legacy/profiles:/:${profile_id}/" "font" "FiraCode Nerd Font 13"
